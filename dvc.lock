schema: '2.0'
stages:
  load_data:
    cmd: python3 src/data_loader.py data/raw/train_sample.txt data/interim/loaded_data.txt
    deps:
    - path: data/raw/train.txt
      hash: md5
      md5: 13fd241a41370119612d5b00b0433009
      size: 93921671
    - path: src/data_loader.py
      hash: md5
      md5: a03d3c929a25cf1e05b8f94b9d7c458e
      size: 619
    outs:
    - path: data/interim/loaded_data.txt
      hash: md5
      md5: aa3239d8309b0c915f6254a22a6fe55b
      size: 4480205
  tokenize_data:
    cmd: python3 src/preprocess.py data/interim/loaded_data.txt data/interim/tokenized_data.txt
      data/interim/tokenizer.json
    deps:
    - path: data/interim/loaded_data.txt
      hash: md5
      md5: aa3239d8309b0c915f6254a22a6fe55b
      size: 4480205
    - path: src/preprocess.py
      hash: md5
      md5: 65a1298032517c2c4077ec3bfeba6d89
      size: 1273
    outs:
    - path: data/interim/tokenized_data.txt
      hash: md5
      md5: 9c87c2864f87847f3afcfc65919795c5
      size: 22404263
    - path: data/interim/tokenizer.json
      hash: md5
      md5: ea5cccf92734d696eba432deb1dc68b8
      size: 6543
  encode_labels:
    cmd: python src/encode_labels.py data/interim/train_labels.txt data/interim/val_labels.txt
      data/interim/test_labels.txt
    deps:
    - path: data/interim/test_labels.txt
      hash: md5
      md5: 2e3c9d7f5cfbbbaa9ab11e95747c6b88
      size: 4045450
    - path: data/interim/train_labels.txt
      hash: md5
      md5: a2628fb8ca50c89fe1250772b8a50206
      size: 11616282
    - path: data/interim/val_labels.txt
      hash: md5
      md5: 3c330979d7cb08758fcd9d6feaf6aa04
      size: 5721418
    - path: src/encode_labels.py
      hash: md5
      md5: abac33936a65a2a6cc92e197d2b8d56d
      size: 1036
    outs:
    - path: data/interim/encoded_test_labels.txt
      hash: md5
      md5: e63840a0a77819d56aa5405a746e5925
      size: 1092594
    - path: data/interim/encoded_train_labels.txt
      hash: md5
      md5: 9f7db0ed64bb77128caa33b3402f97b5
      size: 3137322
    - path: data/interim/encoded_val_labels.txt
      hash: md5
      md5: 36263c753dd478a0eb9165e9a5f988ae
      size: 1545237
  split_train_data:
    cmd: python src/data_split.py data/raw/train.txt data/interim/train_features.txt
      data/interim/train_labels.txt
    deps:
    - path: data/raw/train.txt
      hash: md5
      md5: 13fd241a41370119612d5b00b0433009
      size: 93921671
    - path: src/data_split.py
      hash: md5
      md5: b739448fe210c14ec67f4b853332ccca
      size: 1002
    outs:
    - path: data/interim/train_features.txt
      hash: md5
      md5: e30e89161e21482d56537c6d0889db94
      size: 84396770
    - path: data/interim/train_labels.txt
      hash: md5
      md5: a2628fb8ca50c89fe1250772b8a50206
      size: 11616282
  split_test_data:
    cmd: python src/data_split.py data/raw/test.txt data/interim/test_features.txt
      data/interim/test_labels.txt
    deps:
    - path: data/raw/test.txt
      hash: md5
      md5: a1cab28ad8554fd9269d31e5708469d0
      size: 32724891
    - path: src/data_split.py
      hash: md5
      md5: b739448fe210c14ec67f4b853332ccca
      size: 1002
    outs:
    - path: data/interim/test_features.txt
      hash: md5
      md5: 1563282b483d43739f43f425200044c5
      size: 29407738
    - path: data/interim/test_labels.txt
      hash: md5
      md5: 2e3c9d7f5cfbbbaa9ab11e95747c6b88
      size: 4045450
  split_val_data:
    cmd: python src/data_split.py data/raw/val.txt data/interim/val_features.txt data/interim/val_labels.txt
    deps:
    - path: data/raw/val.txt
      hash: md5
      md5: 7b1e28b1e91582c6f36e85517c3cc6ee
      size: 46258330
    - path: src/data_split.py
      hash: md5
      md5: b739448fe210c14ec67f4b853332ccca
      size: 1002
    outs:
    - path: data/interim/val_features.txt
      hash: md5
      md5: 7d004257a712e5265a5bd985aee42979
      size: 41567033
    - path: data/interim/val_labels.txt
      hash: md5
      md5: 3c330979d7cb08758fcd9d6feaf6aa04
      size: 5721418
  tokenize_features:
    cmd: python src/tokenize_features.py data/interim/train_features.txt data/interim/val_features.txt
      data/interim/test_features.txt
    deps:
    - path: data/interim/test_features.txt
      hash: md5
      md5: 1563282b483d43739f43f425200044c5
      size: 29407738
    - path: data/interim/train_features.txt
      hash: md5
      md5: e30e89161e21482d56537c6d0889db94
      size: 84396770
    - path: data/interim/val_features.txt
      hash: md5
      md5: 7d004257a712e5265a5bd985aee42979
      size: 41567033
    - path: src/tokenize_features.py
      hash: md5
      md5: 39785f7468bbaa3637a4e31f6c96e8b9
      size: 1192
    outs:
    - path: data/interim/tokenized_test.txt
      hash: md5
      md5: 8edfd2cc3629bd6d67b3f652950dea09
      size: 162350139
    - path: data/interim/tokenized_train.txt
      hash: md5
      md5: ec5e6959c77d5c1770341f1ccad2dcbd
      size: 466173135
    - path: data/interim/tokenized_val.txt
      hash: md5
      md5: e182824b8fbed2204f74d4845ab48350
      size: 229605840
    - path: data/interim/tokenizer.pkl
      hash: md5
      md5: 9d5929f8f9169bfee2e18c6672880b9e
      size: 2402
  download_data:
    cmd: python src/data_downloader.py
    deps:
    - path: src/data_downloader.py
      hash: md5
      md5: 4a2b0dd03fc37ce12666bc33c7dce6a4
      size: 1764
    outs:
    - path: data/raw/test.txt
      hash: md5
      md5: a1cab28ad8554fd9269d31e5708469d0
      size: 32724891
    - path: data/raw/train.txt
      hash: md5
      md5: 13fd241a41370119612d5b00b0433009
      size: 93921671
    - path: data/raw/val.txt
      hash: md5
      md5: 7b1e28b1e91582c6f36e85517c3cc6ee
      size: 46258330
  train_model:
    cmd: python src/train_model.py
    deps:
    - path: data/interim/encoded_train_labels.txt
      hash: md5
      md5: 9f7db0ed64bb77128caa33b3402f97b5
      size: 3137322
    - path: data/interim/encoded_val_labels.txt
      hash: md5
      md5: 36263c753dd478a0eb9165e9a5f988ae
      size: 1545237
    - path: data/interim/tokenized_train.txt
      hash: md5
      md5: ec5e6959c77d5c1770341f1ccad2dcbd
      size: 466173135
    - path: data/interim/tokenized_val.txt
      hash: md5
      md5: e182824b8fbed2204f74d4845ab48350
      size: 229605840
    - path: src/train_model.py
      hash: md5
      md5: 4b04ea58714820c538720791b10633eb
      size: 2679
    params:
      params.yaml:
        batch_test: 5000
        batch_train: 5000
        categories:
        - phishing
        - legitimate
        embedding_dimension: 50
        epoch: 1
        loss_function: binary_crossentropy
        optimizer: adam
    outs:
    - path: models/model.keras
      hash: md5
      md5: 624da3ffd42ec3f438857ded5108afd9
      size: 5493632
    - path: reports/loss_plot.svg
      hash: md5
      md5: 184da95d0ad427adfa7191780ab11e8f
      size: 21900
    - path: reports/metrics.json
      hash: md5
      md5: 0320f77442f51d93b92b43dbc9a347d3
      size: 137
  test_model:
    cmd: python src/test_model.py
    deps:
    - path: data/interim/test_features.txt
      hash: md5
      md5: 609e75fbf12e4f1ac9bdc1e40bf8c028
      size: 29043540
    - path: data/interim/test_labels.txt
      hash: md5
      md5: ee87127d4d350f71855f7645118a14e2
      size: 3681252
    - path: models/model.keras
      hash: md5
      md5: 57e7a6418e2ee972ef12d8eadc6a33c0
      size: 5493632
    - path: src/test_model.py
      hash: md5
      md5: f90cd2ab04366759e8d257ca52f0d94d
      size: 1715
    outs:
    - path: reports/classification_report.txt
      hash: md5
      md5: 43e3670668404380935bb8e001779c42
      size: 349
    - path: reports/confusion_matrix.txt
      hash: md5
      md5: a95565759d18ca237b385e29832f1b25
      size: 52
    - path: reports/test_accuracy.txt
      hash: md5
      md5: 9c838b6c95e6d62bbac65f5c32f35de3
      size: 34
    - path: reports/test_loss.txt
      hash: md5
      md5: 100e236d3124cb4a84d5e5871a6f5a69
      size: 31
  upload_model:
    cmd: gsutil cp models/model.keras gs://remla_group_9_model/models.keras
    deps:
    - path: models/model.keras
      hash: md5
      md5: 57e7a6418e2ee972ef12d8eadc6a33c0
      size: 5493632
  upload_tokenizer:
    cmd: gsutil cp data/interim/tokenizer.pkl gs://remla_group_9_model/tokenizer.pkl
    deps:
    - path: data/interim/tokenizer.pkl
      hash: md5
      md5: 94278e3c7a195616ed3f0cd3b9721b79
      size: 2402
  test_long_urls:
    cmd: python tests/test_long_urls.py
    deps:
    - path: models/model.keras
      hash: md5
      md5: 624da3ffd42ec3f438857ded5108afd9
      size: 5493632
    - path: tests/test_long_urls.py
      hash: md5
      md5: eab318be55672223336d8f3898068c70
      size: 2581
    outs:
    - path: reports/test_long_urls.json
      hash: md5
      md5: 4c7cb7cdbbd04ffae239ec08278aeb86
      size: 649
  test_memory_usage:
    cmd: python tests/test_memory_usage.py
    deps:
    - path: models/model.keras
      hash: md5
      md5: 624da3ffd42ec3f438857ded5108afd9
      size: 5493632
    - path: tests/test_memory_usage.py
      hash: md5
      md5: 5e9f8a7a88d9902ac0d893e8e478b730
      size: 2711
    outs:
    - path: reports/test_memory_usage.json
      hash: md5
      md5: d6e59b79a9022824cdb399614b263474
      size: 839
  test_repeatability:
    cmd: python tests/test_repeatability.py
    deps:
    - path: models/model.keras
      hash: md5
      md5: 624da3ffd42ec3f438857ded5108afd9
      size: 5493632
    - path: tests/test_repeatability.py
      hash: md5
      md5: 6464078456f8c086e54aca30f300f7fa
      size: 2210
    outs:
    - path: reports/test_repeatability.json
      hash: md5
      md5: 8f11f7964701d605a6805e1ceeb2c36a
      size: 254
  test_tokenization_latency:
    cmd: python tests/test_tokenization_latency.py
    deps:
    - path: data/interim/tokenized_test.txt
      hash: md5
      md5: 8edfd2cc3629bd6d67b3f652950dea09
      size: 162350139
    - path: tests/test_tokenization_latency.py
      hash: md5
      md5: d49aae1a336a21d63238a40c5f97b0d6
      size: 2209
    outs:
    - path: reports/test_tokenization_latency.json
      hash: md5
      md5: c06064d5648ebfc2547d9e4efade550f
      size: 234
  test_integration:
    cmd: python tests/test_integration.py
    deps:
    - path: models/model.keras
      hash: md5
      md5: 624da3ffd42ec3f438857ded5108afd9
      size: 5493632
    - path: tests/test_integration.py
      hash: md5
      md5: d341ad354b51d283e38d8942f951ded5
      size: 3967
    outs:
    - path: reports/test_integration.json
      hash: md5
      md5: 06d02263452b0f153130d51e7d1b227b
      size: 1351
